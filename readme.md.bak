# æ•°æ®åº“å®‰å…¨å®éªŒç¯å¢ƒ

æœ¬å®éªŒç¯å¢ƒæä¾›äº†å®Œæ•´çš„æ•°æ®åº“å®‰å…¨æ”»é˜²æµ‹è¯•å¹³å°ï¼ŒåŒ…æ‹¬ï¼š
1. **æ”»å‡»æ¨¡æ‹Ÿ**: SQL æ³¨å…¥ã€NoSQL æ³¨å…¥ã€æš´åŠ›ç ´è§£ç­‰
2. **é˜²å¾¡æ£€æµ‹**: ModSecurity WAFã€Suricata IDS
3. **æ•°æ®åŠ å¯†**: Acra é€æ˜ä»£ç†ã€pgcrypto åº”ç”¨å±‚åŠ å¯†

## å®éªŒæ¨¡å—

### ğŸ“¦ æ¨¡å—ä¸€: æ”»å‡»ä¸æ£€æµ‹ (å·²å®Œæˆ)
- æ”»å‡»å·¥å…·: sqlmap, Hydra, è‡ªå®šä¹‰è„šæœ¬
- é˜²å¾¡å·¥å…·: ModSecurity (WAF), Suricata (IDS)
- ç»“æœ: 100% æ£€æµ‹ç‡ï¼Œ0% è¯¯æŠ¥ç‡

### ğŸ” æ¨¡å—äºŒ: æ•°æ®åŠ å¯†å¯¹æ¯” (å·²å®Œæˆ)
- **Acra é€æ˜ä»£ç†**: å»¶è¿Ÿ +53-77%, CPU +123%
- **pgcrypto å†…ç½®æ‰©å±•**: å†™å…¥å»¶è¿Ÿ +10%, è¯»å– CPU +9840%
- å®Œæ•´æŠ¥å‘Š: `ENCRYPTION_REPORT.md`

## å®éªŒç¯å¢ƒ
- ä¸»æœºæ“ä½œç³»ç»Ÿï¼šLinux/macOSï¼ˆå®éªŒèŠ‚ç‚¹é»˜è®¤ shell ä¸º `bash`/`zsh`ï¼‰
- ç¼–æ’æ–¹å¼ï¼šDocker Composeï¼ˆ`docker-compose.yml` å®šä¹‰ï¼Œè¯­æ³•åŸºäº v3.8ï¼‰
- èµ„æºé…é¢ï¼šæ‰€æœ‰æ ¸å¿ƒæœåŠ¡å‡é™åˆ¶ä¸º 4 vCPUã€8 GiB å†…å­˜ï¼ˆ`cpus: "4"`ï¼Œ`mem_limit: 8g`ï¼Œ`mem_reservation: 6g`ï¼‰

### æœåŠ¡æ‹“æ‰‘
| æœåŠ¡ | é•œåƒ / æ„å»º | ç«¯å£æ˜ å°„ | èµ„æºé™åˆ¶ | è¯´æ˜ |
| --- | --- | --- | --- | --- |
| Juice Shop é¶åœº | `bkimminich/juice-shop:latest` | `3001 -> 3000/tcp` | 4 vCPU / 8 GiB | Web é¶ç«™ï¼Œæä¾› SQL/NoSQL æ¼æ´å…¥å£ |
| PostgreSQL (Baseline) | `postgres:13` | `5433 -> 5432/tcp` | 4 vCPU / 8 GiB | åŸºå‡†æ•°æ®åº“ï¼ŒSQLMap & Hydra æ”»å‡»ç›®æ ‡ï¼Œæ•°æ®åº“å `juiceshop_db` |
| PostgreSQL (Acra) | `postgres:13` | `5434 -> 5432/tcp` | 4 vCPU / 8 GiB | Acra åŠ å¯†ä»£ç†åç«¯æ•°æ®åº“ï¼Œæ•°æ®åº“å `acra_db` |
| Acra Server | `cossacklabs/acra-server:0.94.0` | `9393 -> 9393/tcp` | 2 vCPU / 4 GiB | é€æ˜åŠ å¯†ä»£ç†ï¼Œæ‹¦æˆªå¹¶åŠ å¯† PostgreSQL é€šä¿¡ |
| PostgreSQL (pgcrypto) | `postgres:13` | `5435 -> 5432/tcp` | 4 vCPU / 8 GiB | pgcrypto æ‰©å±•æµ‹è¯•æ•°æ®åº“ï¼Œæ•°æ®åº“å `pgcrypto_db` |
| MongoDB | `mongo:4` | `27018 -> 27017/tcp` | 4 vCPU / 8 GiB | NoSQL æ³¨å…¥æµ‹è¯•ç›®æ ‡ |
| Vulnerable API (`vuln-api`) | æœ¬åœ°æ„å»º `Dockerfile.vuln` | å†…éƒ¨ `8081/tcp`ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰ | 2 vCPU / 4 GiB | Flask æ¼æ´ APIï¼ŒModSecurity ä¸ Suricata çš„åç«¯ç›®æ ‡ |
| ModSecurity WAF | æœ¬åœ°æ„å»º `Dockerfile.modsecurity` â†’ `local-modsecurity:latest` | `8081 -> 8080/tcp` | 2 vCPU / 4 GiB | åå‘ä»£ç† + OWASP CRSï¼ŒæŒ‚è½½å®¡è®¡/è®¿é—®æ—¥å¿—ç›®å½• |
| Suricata IDS | æœ¬åœ°æ„å»º `Dockerfile.suricata` â†’ `local-suricata:latest` | ä¸ WAF å…±ç”¨ç½‘ç»œï¼ˆæ— ç‹¬ç«‹ç«¯å£ï¼‰ | 2 vCPU / 4 GiB | ç›‘å¬ WAF æµé‡ï¼ŒåŠ è½½ SQL æ³¨å…¥è§„åˆ™å¹¶å†™å…¥ `results/suricata` |
| æ”»å‡»å®¢æˆ·ç«¯ | è‡ªå®šä¹‰é•œåƒ `db-security-attack-client:latest`ï¼ˆç”±æ ¹ç›®å½• Dockerfile æ„å»ºï¼‰ | æ— å¯¹å¤–ç«¯å£ | 4 vCPU / 8 GiB | è¿è¡Œè‡ªåŠ¨åŒ–æ”»å‡»ã€æ¼æ´åº”ç”¨ä¸æµ‹é‡è„šæœ¬ | ä¸»æœºæ“ä½œç³»ç»Ÿï¼šLinuxï¼ˆå®éªŒèŠ‚ç‚¹é»˜è®¤ shell ä¸º `bash`ï¼‰ã€‚
- ç¼–æ’æ–¹å¼ï¼šDocker Composeï¼ˆ`docker-compose.yml` å®šä¹‰ï¼Œè¯­æ³•åŸºäº v3.8ï¼‰ã€‚
- èµ„æºé…é¢ï¼šæ‰€æœ‰æ ¸å¿ƒæœåŠ¡å‡é™åˆ¶ä¸º 4 vCPUã€8â€¯GiB å†…å­˜ï¼ˆ`cpus: "4"`ï¼Œ`mem_limit: 8g`ï¼Œ`mem_reservation: 6g`ï¼‰ã€‚

### æœåŠ¡æ‹“æ‰‘
| æœåŠ¡ | é•œåƒ / æ„å»º | ç«¯å£æ˜ å°„ | èµ„æºé™åˆ¶ | è¯´æ˜ |
| --- | --- | --- | --- | --- |
| Juice Shop é¶åœº | `bkimminich/juice-shop:latest` | `3001 -> 3000/tcp` | 4 vCPU / 8â€¯GiB | Web é¶ç«™ï¼Œæä¾› SQL/NoSQL æ¼æ´å…¥å£ |
| PostgreSQL | `postgres:13` | `5433 -> 5432/tcp` | 4 vCPU / 8â€¯GiB | SQLMap & Hydra æ”»å‡»ç›®æ ‡ï¼Œæ•°æ®åº“å `juiceshop_db` |
| MongoDB | `mongo:4` | `27018 -> 27017/tcp` | 4 vCPU / 8â€¯GiB | NoSQL æ³¨å…¥æµ‹è¯•ç›®æ ‡ |
| Vulnerable API (`vuln-api`) | æœ¬åœ°æ„å»º `Dockerfile.vuln` | å†…éƒ¨ `8081/tcp`ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰ | 2 vCPU / 4â€¯GiB | Flask æ¼æ´ APIï¼ŒModSecurity ä¸ Suricata çš„åç«¯ç›®æ ‡ |
| ModSecurity WAF | æœ¬åœ°æ„å»º `Dockerfile.modsecurity` â†’ `local-modsecurity:latest` | `8081 -> 8080/tcp` | 2 vCPU / 4â€¯GiB | åå‘ä»£ç† + OWASP CRSï¼ŒæŒ‚è½½å®¡è®¡/è®¿é—®æ—¥å¿—ç›®å½• |
| Suricata IDS | æœ¬åœ°æ„å»º `Dockerfile.suricata` â†’ `local-suricata:latest` | ä¸ WAF å…±ç”¨ç½‘ç»œï¼ˆæ— ç‹¬ç«‹ç«¯å£ï¼‰ | 2 vCPU / 4â€¯GiB | ç›‘å¬ WAF æµé‡ï¼ŒåŠ è½½ SQL æ³¨å…¥è§„åˆ™å¹¶å†™å…¥ `results/suricata` |
| æ”»å‡»å®¢æˆ·ç«¯ | è‡ªå®šä¹‰é•œåƒ `db-security-attack-client:latest`ï¼ˆç”±æ ¹ç›®å½• Dockerfile æ„å»ºï¼‰ | æ— å¯¹å¤–ç«¯å£ | 4 vCPU / 8â€¯GiB | è¿è¡Œè‡ªåŠ¨åŒ–æ”»å‡»ã€æ¼æ´åº”ç”¨ä¸æµ‹é‡è„šæœ¬ |

## æ”»å‡»å®¢æˆ·ç«¯é•œåƒ
- åŸºç¡€é•œåƒï¼š`ubuntu:20.04`ã€‚
- APT å®‰è£…ï¼š`python3`ã€`python3-pip`ã€`python3-psycopg2`ã€`python3-venv`ã€`curl`ã€`git`ã€`sqlmap`ã€`hydra`ã€‚
- Python ä¾èµ–ï¼š`Flask`ã€`PyMongo`ï¼ˆé€šè¿‡ `pip3` å®‰è£…ï¼‰ã€‚
- è‡ªå¸¦æ–‡ä»¶ï¼š
	- `/root/attack-scripts/*.py` â€”â€” è‡ªåŠ¨åŒ–æ”»å‡»ä¸æµ‹é‡è„šæœ¬ã€‚
	- `/root/vuln_app.py` â€”â€” Flask æ¼æ´æ¼”ç¤ºåº”ç”¨ï¼ˆéœ€æ‰‹åŠ¨å¯åŠ¨ï¼‰ã€‚

## æ ¸å¿ƒå·¥å…·ä¸æ¡†æ¶ç‰ˆæœ¬
| å·¥å…· / åº“ | ç‰ˆæœ¬ | è·å–æ–¹å¼ | å¤‡æ³¨ |
| --- | --- | --- | --- |
| Python | 3.8.10 | `python3 --version` | Ubuntu 20.04 é»˜è®¤ |
| sqlmap | 1.4.4#stable | `sqlmap --version` | apt è½¯ä»¶æºæä¾› |
| Hydra | v9.0 | `hydra -h` é¦–è¡Œ | apt è½¯ä»¶æºæä¾› |
| Flask | 3.0.3 | `python3 -c "import flask"` | pip å®‰è£… |
| PyMongo | 4.10.1 | `python3 -c "import pymongo"` | pip å®‰è£… |

## æ•°æ®åº“ä¸é¶åœºç‰ˆæœ¬
- PostgreSQLï¼šé•œåƒ `postgres:13`ï¼ˆæ•°æ®åº“ç”¨æˆ·/å¯†ç ç”± Compose ç¯å¢ƒå˜é‡è®¾ç½®ï¼š`youruser` / `password123`ï¼‰ã€‚
- MongoDBï¼šé•œåƒ `mongo:4`ã€‚
- Juice Shopï¼šé•œåƒ `bkimminich/juice-shop:latest`ï¼ˆå®˜æ–¹æœ€æ–°å‘å¸ƒï¼‰ã€‚

## å­—å…¸ä¸è¾“å…¥æ•°æ®
- `attack-scripts/users.txt` â€”â€” Hydra å­—å…¸æ”»å‡»ä½¿ç”¨çš„ç”¨æˆ·ååˆ—è¡¨ã€‚
- `attack-scripts/passwords.txt` â€”â€” Hydra å­—å…¸æ”»å‡»ä½¿ç”¨çš„å¯†ç åˆ—è¡¨ã€‚
- `results/pins_4digit_top1000.txt` â€”â€” è‡ªåŠ¨è„šæœ¬ä» SecListsï¼ˆ`Passwords/Common-Credentials/four-digit-pin-codes-sorted-by-frequency-withcount.csv`ï¼‰æå–çš„å‰ 1000 ä¸ªå››ä½ PINï¼›è‹¥ SecLists ä¸å­˜åœ¨åˆ™è„šæœ¬å›é€€åˆ°çº¯æ•°å­—æš´åŠ›æšä¸¾ã€‚

## è‡ªåŠ¨åŒ–ä¸ç›‘æ§è„šæœ¬
- `attack-scripts/automate_attacks.py`
	- ä¸²è” SQLMapã€Hydra åœºæ™¯å¹¶å†™å…¥ `results/attack_metrics.csv`ã€‚
	- è®°å½•æŒ‡æ ‡ï¼šæˆåŠŸç‡ã€å¹³å‡è¯·æ±‚å»¶è¿Ÿã€`docker stats` é‡‡é›†çš„å³°å€¼ CPU / å†…å­˜å ç”¨ã€‚
- `attack-scripts/measure_http_requests.py` åŠ `measure_pg_union.py` / `measure_pg_timeblind.py`
	- ä¸ºä¸åŒæµç¨‹æµ‹é‡ HTTP å“åº”æ—¶é—´ï¼Œæ”¯æŒåŒæ­¥æˆ–å¼‚æ­¥é‡‡æ ·ã€‚
- èµ„æºç›‘æ§ï¼š`monitor_resources` çº¿ç¨‹ä½¿ç”¨ `docker stats --no-stream` é‡‡é›†æ•°æ®ã€‚

## è¿è¡Œè¯´æ˜

### æ”»å‡»æµ‹è¯•
```bash
cd /root/db-security-experiment
python3 attack-scripts/automate_attacks.py
```
- ç»“æœï¼š
	- æŒ‡æ ‡ CSVï¼š`results/attack_metrics.csv`
	- è¯¦ç»†æ—¥å¿—ï¼š`results/logs/<æ”»å‡»åç§°>.stdout.log|stderr.log`
	- ç”Ÿæˆçš„ PIN å­—å…¸ï¼š`results/pins_4digit_top1000.txt`

### åŠ å¯†æ€§èƒ½æµ‹è¯•
```bash
# å¯åŠ¨åŠ å¯†ä»£ç†å®¹å™¨
docker compose up -d postgres-acra acra-server postgres-pgcrypto

# è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼ˆéœ€è¦åœ¨ä¸»æœºç¯å¢ƒï¼‰
source .venv/bin/activate
python attack-scripts/benchmark_encryption.py
```
- ç»“æœï¼š
	- åŸå§‹æ•°æ®ï¼š`results/encryption_benchmark.csv`
	- è¯¦ç»†åˆ†æï¼š`results/encryption_benchmark.md`
	- æ·±åº¦å¯¹æ¯”ï¼š`results/encryption_comparison.md`
	- å®Œæ•´æŠ¥å‘Šï¼š`ENCRYPTION_REPORT.md`

## å®éªŒç»“æœæ±‡æ€»
_ç”Ÿæˆæ—¶é—´: 2025-09-29T12:47:26+00:00 UTC_

### æ”»å‡»æ‰§è¡Œæ€§èƒ½ (èŠ‚é€‰)
| å·¥å…· | ç›®æ ‡ | æ”»å‡»ç±»å‹ | æˆåŠŸç‡% | å¹³å‡å»¶è¿Ÿms | å³°å€¼CPU% | å³°å€¼å†…å­˜% | å¤‡æ³¨ |
| ---- | ---- | -------- | ------ | ---------- | -------- | -------- | ---- |
| Hydra | PostgreSQL | å­—å…¸æ”»å‡» | 0 | - | - | - |  |
| Hydra | PostgreSQL | æš´åŠ›ç ´è§£ | 0 | - | - | - |  |
| raw-http | PostgreSQL | åŸºç¡€SQLæ³¨å…¥ | 0 | - | 12.5 | - | 0.7 |
| raw-http | PostgreSQL | æ··æ·†SQLæ³¨å…¥ | 0 | - | 20.0 | - | 0.7 |
| raw-http | PostgreSQL | å­˜å‚¨è¿‡ç¨‹è°ƒç”¨ | 0 | - | 33.3 | - | 0.7 |
| sqlmap | PostgreSQL | è”åˆæŸ¥è¯¢æ³¨å…¥ | 0 | - | 14.2 | - | 0.7 |
| sqlmap | PostgreSQL | æ—¶é—´ç›²æ³¨ | 100 | - | 11.1 | - | 0.71 |
| sqlmap | MongoDB | NoSQLæ³¨å…¥ | 100 | - | 0.8 | - | 1.74 |
| Hydra | PostgreSQL | å­—å…¸æ”»å‡» | 100 | - | 50.0 | - | 0.72 |
| Hydra | PostgreSQL | æš´åŠ›ç ´è§£ | 0 | - | 22.2 | - | 0.78 |

### æ£€æµ‹æ•ˆæœ (SQL æ³¨å…¥)
| å·¥å…· | åœºæ™¯ | æ ·æœ¬é‡ (æ¶æ„/è‰¯æ€§) | TP | FN | TPR% | FP | TN | FPR% |
| ---- | ---- | ----------------- | -- | -- | ---- | -- | -- | ---- |
| ModSecurity | åŸºç¡€SQLæ³¨å…¥ | 150 / 150 | 150 | 0 | 100.0 | 0 | 150 | 0.0 |
| Suricata | åŸºç¡€SQLæ³¨å…¥ | 150 / 150 | 150 | 0 | 100.0 | 0 | 150 | 0.0 |
| ModSecurity | æ··æ·†SQLæ³¨å…¥ | 150 / 150 | 150 | 0 | 100.0 | 0 | 150 | 0.0 |
| Suricata | æ··æ·†SQLæ³¨å…¥ | 150 / 150 | 150 | 0 | 100.0 | 0 | 150 | 0.0 |
| ModSecurity | å­˜å‚¨è¿‡ç¨‹è°ƒç”¨ | 150 / 150 | 150 | 0 | 100.0 | 0 | 150 | 0.0 |
| Suricata | å­˜å‚¨è¿‡ç¨‹è°ƒç”¨ | 150 / 150 | 150 | 0 | 100.0 | 0 | 150 | 0.0 |

### æ•°æ®åŠ å¯†ä»£ç†æ€§èƒ½
_æ›´æ–°æ—¶é—´: 2025-10-01_

| å·¥å…· | æ“ä½œç±»å‹ | åŠ å¯†ç±»å‹ | Baselineå»¶è¿Ÿ (ms) | åŠ å¯†åå»¶è¿Ÿ (ms) | å»¶è¿Ÿå¼€é”€ (%) | CPUå¼€é”€ (%) |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| Acra | å†™å…¥ | æ ‡å‡† | 3.91 | 6.93 | 77.33 | 123.03 |
| Acra | è¯»å– | æ ‡å‡† | 1.48 | 2.26 | 53.14 | â€” |
| Acra | è¯»å– | å¯æœç´¢ | 1.60 | 2.86 | 79.21 | â€” |
| pgcrypto | å†™å…¥ | æ ‡å‡† | 3.91 | 4.30 | 10.00 | 671.60 |
| pgcrypto | è¯»å– | æ ‡å‡† | 1.48 | 2.71 | 84.00 | 9840.00 |
| pgcrypto | è¯»å– | å¯æœç´¢ | 1.60 | 1.47 | -8.09 | 0.00 |

**å…³é”®å‘ç°**:
- **Acra é€æ˜åŠ å¯†ä»£ç†**: é›¶ä»£ç ä¿®æ”¹ï¼Œå¹³è¡¡æ€§èƒ½ (53-77% å»¶è¿Ÿå¢åŠ ï¼Œ123% CPU å¼€é”€)ï¼Œé€‚åˆé—ç•™ç³»ç»Ÿ
- **pgcrypto åº”ç”¨å±‚åŠ å¯†**: å†™å…¥æ€§èƒ½æœ€ä¼˜ (10% å»¶è¿Ÿ)ï¼Œä½†è¯»å– CPU å¼€é”€æé«˜ (9840%)ï¼Œé€‚åˆå†™å¯†é›†å‹æ–°åº”ç”¨
- **CipherStash**: æµ‹è¯•å¤±è´¥ï¼Œéé€æ˜ä»£ç†ï¼Œéœ€è¦åº”ç”¨æ”¹å†™æŸ¥è¯¢

è¯¦ç»†åˆ†æè§:
- `results/encryption_benchmark.md` - è¯¦ç»†æ€§èƒ½åˆ†æ
- `results/encryption_comparison.md` - æ·±åº¦æ–¹æ¡ˆå¯¹æ¯”
- `ENCRYPTION_REPORT.md` - å®Œæ•´å®éªŒæŠ¥å‘Š

### è¯´æ˜
- åŸºç¡€SQLæ³¨å…¥: ç›´æ¥ä½¿ç”¨ UNION SELECT æå–ä¿¡æ¯ã€‚
- æ··æ·†SQLæ³¨å…¥: åœ¨å…³é”®å­—ä¹‹é—´ä½¿ç”¨æ³¨é‡Šç»•è¿‡ç®€å•åŒ¹é…ã€‚
- å­˜å‚¨è¿‡ç¨‹è°ƒç”¨: åˆ©ç”¨ pg_sleep() è¿›è¡Œæ—¶é—´å»¶è¿Ÿä¾§ä¿¡é“ã€‚
- TPR=True Positive Rate, FPR=False Positive Rateã€‚
- æœ¬è½®æµ‹è¯•æ¯ç±»åœºæ™¯å…±ç”Ÿæˆ 150 æ¡æ¶æ„ä¸ 150 æ¡æ­£å¸¸è¯·æ±‚ã€‚Suricata åœ¨åŸºç¡€ä¸æ··æ·†åœºæ™¯ä¸­å¯¹æ¯ä¸ªæ¶æ„è¯·æ±‚å‡è§¦å‘äº†åŒé‡å‘Šè­¦ (å…± 300 æ¡)ï¼Œä»ç„¶è®¡ç®—ä¸º 150 ä¸ªæœ‰æ•ˆå‘Šè­¦ã€‚
- **åŠ å¯†æµ‹è¯•**: æ¯ç§æ“ä½œæ‰§è¡Œ 120 ä¸ªæ ·æœ¬ï¼Œä½¿ç”¨ `docker stats` é‡‡æ · CPU å¼€é”€ã€‚
